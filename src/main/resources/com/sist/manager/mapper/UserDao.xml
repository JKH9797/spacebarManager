<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sist.manager.dao.UserDao">

	<resultMap type="com.sist.manager.model.User" id="userResultMap">
		<id column="USER_ID" property="userId" />
		<result column="USER_PWD" property="userPwd" />
		<result column="USER_NAME" property="userName" />
		<result column="EMAIL" property="email" />
		<result column="USER_STAT" property="userStat" />
		<result column="JOIN_DT" property="joinDt" />
		<result column="PHONE" property="phone" />
		<result column="USER_ADDR" property="userAddr" />
		<result column="NICKNAME" property="nickname" />
		<result column="GENDER" property="gender" />
		<result column="BIRTH_DT" property="birthDt" />
		<result column="MILE" property="mile" />
		<result column="USER_TYPE" property="userType" />
		<result column="APPROV_STAT" property="approvStat" />
		<result column="PROF_IMG_EXT" property="profImgExt" />
		
	</resultMap>						   
				  
		
	<select id="userList" parameterType="com.sist.manager.model.User" resultMap="userResultMap">
				SELECT  USER_ID,
				        USER_PWD,
				        USER_NAME,
				        EMAIL,
				        USER_STAT,
				        JOIN_DT,
				        PHONE,
				        NICKNAME,
				        USER_TYPE,
				        APPROV_STAT,
				        MILE
				FROM ( SELECT  ROWNUM AS RNUM,
				                USER_ID,
				                USER_PWD,
				                USER_NAME,
				                EMAIL,
				                USER_STAT,
				                JOIN_DT,
				                PHONE,
				                NICKNAME,
				                USER_TYPE,
				                APPROV_STAT,
				                MILE
				        FROM (           SELECT  USER_ID,
				                                NVL(USER_PWD, '') USER_PWD,
				                                NVL(USER_NAME, '') USER_NAME,
				                                NVL(EMAIL, '') EMAIL,
				                                NVL(USER_STAT, 'N') USER_STAT,
				                                NVL(TO_CHAR(JOIN_DT, 'YYYY.MM.DD HH24:MI:SS'), '') JOIN_DT,
				                                NVL(PHONE, '') PHONE,
				                                NVL(NICKNAME, '') NICKNAME,
				                                NVL(USER_TYPE, '') USER_TYPE,
				                                NVL(APPROV_STAT, '') APPROV_STAT,
												NVL(MILE, '') MILE
												
				                          FROM  SB_USER
				                         WHERE  1=1 
				                 <if test='userType != null and userType != ""'>        
				                           AND  USER_TYPE LIKE '%' || #{userType} || '%'
				                 </if>         
				                 <if test='userStat != null and userStat != ""'>        
				                           AND  USER_STAT LIKE '%' || #{userStat} || '%'
				                 </if> 
				                 <if test='userId != null and userId !=""'>         
				                           AND  USER_ID LIKE '%' || #{userId} || '%'
				                 </if>
				                 <if test='userName != null and userName !=""'>
				                           AND  USER_NAME LIKE '%' || #{userName} || '%'
				                 </if>
				                 <if test='phone != null and phone !=""'>
				                           AND  PHONE LIKE '%' || #{phone} || '%'
				                 </if>
				                 <if test='nickname != null and nickname !=""'>
				                           AND  NICKNAME LIKE '%' || #{nickname} || '%'
				                 </if>
				                 <if test='approvStat != null and approvStat == "N"'>        
				                           AND  APPROV_STAT = #{approvStat}
				                 </if> 
				                         ORDER BY JOIN_DT DESC))
				                         
				WHERE RNUM <![CDATA[>=]]> #{startRow}
				  AND RNUM <![CDATA[<=]]> #{endRow}
	</select>
	
	<select id="userListCount" parameterType="com.sist.manager.model.User" resultType="int">
	SELECT COUNT(USER_ID) CNT
	  FROM  SB_USER
	 WHERE  1=1 
	 <if test='userType != null and userType != ""'>        
		AND  USER_TYPE LIKE '%' || #{userType} || '%'
	 </if>
	 <if test='userStat != null and userStat != ""'>
	   AND  USER_STAT LIKE '%' || #{userStat} || '%'
	 </if>
	 <if test='userId != null and userId != ""'>
	   AND  USER_ID LIKE '%' || #{userId} || '%'
	 </if>  
	 <if test='userName != null and userName != ""'>
	   AND  USER_NAME LIKE '%' || #{userName} || '%'
	 </if>
	 <if test='phone != null and phone !=""'>
       AND  PHONE LIKE '%' || #{phone} || '%'
     </if>
     <if test='nickname != null and nickname !=""'>
       AND  NICKNAME LIKE '%' || #{nickname} || '%'
     </if>
     <if test='approvStat != null and approvStat == "N"'>        
       AND  APPROV_STAT = #{approvStat}
     </if> 
	 
	</select>
	
	<select id="userSelect" parameterType="string" resultMap="userResultMap">
					SELECT
				    USER_ID,
				    NVL(USER_PWD, '') USER_PWD,
				    NVL(USER_NAME, '') USER_NAME,
				    NVL(EMAIL, '') EMAIL,
				    NVL(USER_STAT, 'N') USER_STAT,
				    NVL(TO_CHAR(JOIN_DT, 'YYYY.MM.DD HH24:MI:SS'), '') JOIN_DT,
				    NVL(PHONE, '') PHONE,
                    NVL(NICKNAME, '') NICKNAME,
                    NVL(APPROV_STAT, '') APPROV_STAT

				FROM SB_USER
				WHERE USER_ID = #{value}
	</select>
	
	<update id="userUpdate" parameterType="com.sist.manager.model.User">
				UPDATE SB_USER
				   SET USER_PWD = #{userPwd},
				       USER_NAME = #{userName},
				       EMAIL = #{email},
				       USER_STAT = #{userStat},
				       PHONE = #{phone},
				       NICKNAME = #{nickname},
				       APPROV_STAT = #{approvStat}
				       
				WHERE USER_ID = #{userId}
	</update>
	
	<update id="userApprove" parameterType="String">
	  UPDATE SB_USER
	     SET approv_stat = 'Y'
	   WHERE user_id     = #{value}
	</update>
  	
  	
	<select id="findSellersByQuery" parameterType="map" resultMap="userResultMap">
	    SELECT
	        USER_ID,
	        USER_NAME
	    FROM (
	        SELECT
	            ROWNUM AS RNUM,
	            USER_ID,
	            USER_NAME
	        FROM (
	            SELECT
	                USER_ID,
	                USER_NAME
	            FROM
	                SB_USER
	            WHERE
	                USER_TYPE = 'H'
	            <if test="query != null and query != ''">
	                AND (
	                    USER_ID LIKE '%' || #{query} || '%' OR
	                    USER_NAME LIKE '%' || #{query} || '%'
	                )
	            </if>
	            ORDER BY USER_NAME ASC
	        )
	    )
	    WHERE RNUM BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="countSellersByQuery" parameterType="map" resultType="int">
	    SELECT
	        COUNT(*)
	    FROM
	        SB_USER
	    WHERE
	        USER_TYPE = 'H'
	    <if test="query != null and query != ''">
	        AND (
	            USER_ID LIKE '%' || #{query} || '%' OR
	            USER_NAME LIKE '%' || #{query} || '%'
	        )
	    </if>
	</select>
	
	
</mapper>
