<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- src/main/resources/mapper/NoticeMapper.xml -->
<mapper namespace="com.sist.manager.dao.NoticeDao">

    <!-- 공지사항 목록 -->
    <!-- 공지사항 목록 조회 쿼리 예시 -->
	<select id="selectNoticeList" resultType="com.sist.manager.model.Notice">
	    SELECT 
	        n.NOTICE_SEQ          AS noticeSeq,
	        n.NOTICE_TITLE        AS noticeTitle,
	        n.NOTICE_CONTENT      AS noticeContent,
	        n.ADMIN_ID            AS adminId,
	        a.ADMIN_NAME          AS adminName,  <!-- 관리자 이름 추가 -->
	        n.NOTICE_STAT         AS noticeStat,
	        n.REG_DT              AS regDt,
	        n.UPDATE_DT           AS updateDt
	    FROM NOTICE n
	    LEFT JOIN ADMIN a ON n.ADMIN_ID = a.ADMIN_ID

	    ORDER BY n.REG_DT DESC
	</select>

    <select id="selectNoticeDetail" resultType="com.sist.manager.model.Notice" parameterType="int">
	    SELECT 
	        NOTICE_SEQ AS noticeSeq,
	        NOTICE_TITLE AS noticeTitle,
	        NOTICE_CONTENT AS noticeContent,
	        ADMIN_ID AS adminId,
	        NOTICE_STAT AS noticeStat,
	        REG_DT AS regDt,
	        UPDATE_DT AS updateDt
	    FROM NOTICE
	    WHERE NOTICE_SEQ = #{noticeSeq}
	</select>

    <!-- 공지사항 등록 -->
    <insert id="insertNotice" parameterType="com.sist.manager.model.Notice" >
    	<selectKey resultType="int" keyProperty="noticeSeq" order="BEFORE">
					SELECT SEQ_NOTICE_SEQ.NEXTVAL FROM DUAL
				</selectKey>
    	
        INSERT INTO NOTICE
    (NOTICE_SEQ, NOTICE_TITLE, NOTICE_CONTENT, ADMIN_ID, NOTICE_STAT, REG_DT, UPDATE_DT)
  VALUES
    (#{noticeSeq}, #{noticeTitle}, #{noticeContent}, #{adminId},
     'Y', SYSDATE, SYSDATE)
    </insert>
    
    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.sist.manager.model.Notice">
    	UPDATE NOTICE
    SET NOTICE_TITLE   = #{noticeTitle},
        NOTICE_CONTENT = #{noticeContent},
        NOTICE_STAT    = #{noticeStat},
        UPDATE_DT      = SYSDATE
    WHERE NOTICE_SEQ = #{noticeSeq}
    </update>
   	
    

    <!-- 댓글 등록 -->
    <insert id="insertReply" parameterType="com.sist.manager.model.NoticeReply">
        INSERT INTO NOTICE_REPLY (REPLY_SEQ, NOTICE_SEQ, USER_ID, REPLY_CONTENT)
        VALUES (NOTICE_REPLY_SEQ.NEXTVAL, #{noticeSeq}, #{userId}, #{replyContent})
    </insert>

    <!-- 댓글 목록 -->
    <select id="selectRepliesByNotice" resultType="com.sist.manager.model.NoticeReply" parameterType="int">
        SELECT * FROM NOTICE_REPLY WHERE NOTICE_SEQ = #{value} ORDER BY REPLY_SEQ
    </select>

</mapper>

